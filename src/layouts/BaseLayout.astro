---
import { settings } from '../data/settings';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SVGSprite from '../components/SVGSprite.astro';
import '../styles/global.scss';

interface Props {
  title: string;
  description?: string;
  featuredImage?: string;
  type?: 'website' | 'article';
  publishedTime?: Date;
  tags?: string[];
}

const { title, description = settings.basic.site_tagline, featuredImage = '/images/generic/main-cover.webp', type = 'website', publishedTime, tags } = Astro.props;
const authorName = 'Keng Susumpow';
const siteTitle = settings.basic.site_title;
const pageTitle = Astro.url.pathname === '/' ? `${siteTitle} – ${title}` : `${title} – ${siteTitle}`;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const fullFeaturedImage = new URL(featuredImage, Astro.site).toString();
const siteLogo = new URL('/images/logo.webp', Astro.site).toString();
---

<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- Page Info -->
  <link rel="shortcut icon" href={settings.basic.favicon_image}>
  <title>{pageTitle}</title>
  <meta name="description" content={description}>

  <!-- Canonical URL -->
  <link rel="canonical" href={canonicalURL}>

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@kengggg">
  <meta name="twitter:title" content={pageTitle}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content={fullFeaturedImage}>

  <!-- Facebook OpenGraph -->
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:type" content={type}>
  <meta property="og:site_name" content={siteTitle}>
  <meta property="og:locale" content="en_US">
  <meta property="og:title" content={pageTitle}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={fullFeaturedImage}>
  <meta property="og:image:secure_url" content={fullFeaturedImage}>
  <meta property="og:image:width" content="1920">
  <meta property="og:image:height" content="1080">
  <meta property="og:logo" content={siteLogo}>

  <!-- Article-specific OpenGraph (for blog posts) -->
  {type === 'article' && publishedTime && (
    <meta property="article:published_time" content={publishedTime.toISOString()} />
  )}
  {type === 'article' && (
    <meta property="article:author" content={authorName} />
  )}
  {type === 'article' && tags && tags.map((tag) => (
    <meta property="article:tag" content={tag} />
  ))}

  <!-- Preconnect hints for faster external resource loading -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Font Embed Code -->
  <link href={settings.fonts.embed_url} rel="stylesheet">

  <!-- Styles -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Inline SVG sprite -->
  <SVGSprite />
</head>

<body class={`loading${settings.advanced.ajax_loading ? ' ajax-loading' : ''}`} data-site-url={Astro.site} data-page-url={Astro.url.pathname}>

  <Header featuredImage={featuredImage} />

  <div class="loader">
    <svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg">
      <circle cx="15" cy="15" r="15">
        <animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" />
        <animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" />
      </circle>
      <circle cx="60" cy="15" r="9" fill-opacity="0.3">
        <animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" />
        <animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" />
      </circle>
      <circle cx="105" cy="15" r="15">
        <animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" />
        <animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" />
      </circle>
    </svg>
  </div>

  <div class="page-loader"></div>

  <div class="page">
    <div class="page__content" data-page-title={pageTitle} data-image={featuredImage}>
      <slot />
    </div>
  </div>

  <Footer />

  <!-- Javascript Assets (Vanilla JS - No jQuery) -->
  <script src="/js/journal.js" defer></script>
</body>
</html>
